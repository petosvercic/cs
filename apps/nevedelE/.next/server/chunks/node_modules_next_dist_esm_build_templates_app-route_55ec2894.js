module.exports=[68404,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),i=e.i(59756),n=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),u=e.i(87718),c=e.i(95169),d=e.i(47587),p=e.i(66012),g=e.i(70101),f=e.i(26937),y=e.i(10372),h=e.i(93695);e.i(52474);var m=e.i(220),A=e.i(89171);function S(e){return String(e??"").trim()}function k(e,t){return`${e}-${String(t).padStart(3,"0")}`}function E(e,t){return`c${e+1}_t${t+1}`}function T(e,t){let r=S(e)||"Task",a=Array.isArray(t)?t.map(S).filter(Boolean):[];for(0===a.length&&(a=[r,r+" (quick)",r+" (deep)"]);a.length<3;)a.push(a[a.length-1]);return a.length>3&&(a=a.slice(0,3)),a}var b=e.i(85637);function v(e){return{accept:"application/vnd.github+json",authorization:`Bearer ${e}`,"x-github-api-version":"2022-11-28","content-type":"application/json"}}async function R(e){let t=`https://api.github.com/repos/${e.owner}/${e.repo}/contents/${e.path}?ref=${encodeURIComponent(e.ref)}`,r=await fetch(t,{headers:v(e.token)});if(404===r.status)return null;if(!r.ok)throw Error(`GITHUB_CONTENT_GET_FAILED:${r.status}`);let a=await r.json(),i="string"==typeof a?.content?Buffer.from(String(a.content).replace(/\n/g,""),"base64").toString("utf8"):"";return{sha:String(a?.sha||""),content:i}}async function $(e){let t=`https://api.github.com/repos/${e.owner}/${e.repo}/contents/${e.path}`,r={message:e.message,branch:e.ref,content:Buffer.from(e.content,"utf8").toString("base64")};e.sha&&(r.sha=e.sha);let a=await fetch(t,{method:"PUT",headers:v(e.token),body:JSON.stringify(r)});if(!a.ok){let e=await a.text().catch(()=>"");throw Error(`GITHUB_CONTENT_PUT_FAILED:${a.status}:${e.slice(0,200)}`)}}async function _(e){let t=new Date().toISOString(),r={...e.edition,createdAt:e.edition.createdAt||t},a=String(r.slug),i="apps/nevedelE/data/editions.json",n=`apps/nevedelE/data/editions/${a}.json`,o=await R({...e,path:i}),s=o?.sha,l={editions:[]};if(o?.content)try{l=JSON.parse(o.content.replace(/^\uFEFF/,""))}catch{l={editions:[]}}Array.isArray(l.editions)||(l.editions=[]);let u=l.editions.findIndex(e=>e?.slug===a);-1===u?l.editions.unshift({slug:a,title:String(r.title||a),createdAt:r.createdAt,updatedAt:t}):l.editions[u]={...l.editions[u],title:String(r.title||a),updatedAt:t},await $({...e,path:i,sha:s,message:`chore(factory): update index for ${a}`,content:JSON.stringify(l,null,2)+"\n"});let c=await R({...e,path:n});return await $({...e,path:n,sha:c?.sha,message:`chore(factory): add edition ${a}`,content:JSON.stringify({...r,updatedAt:t},null,2)+"\n"}),{slug:a}}async function w(e){try{var t;let r,a,i=function(e){let t=(process.env.FACTORY_TOKEN||"").trim();if(!t)return{ok:!1,status:401,error:"FACTORY_TOKEN_MISSING"};let r=(e.headers.get("x-factory-token")||"").trim();if(r&&r===t)return{ok:!0};let a=e.headers.get("cookie")||"";return/(?:^|;\s*)factory=1(?:;|$)/.test(a)?{ok:!0}:{ok:!1,status:401,error:"UNAUTHORIZED"}}(e);if(!i.ok)return A.NextResponse.json({ok:!1,error:i.error},{status:i.status});let n=await e.json().catch(()=>null),o=n?.rawEditionJson,s="string"==typeof o?o:o?JSON.stringify(o):"",l=n?.edition,u=s||JSON.stringify(l??{}),c=(0,b.listEditions)().map(e=>e.slug),d=function(e,t=[]){var r,a,i,n;let o,s,l,u,c=(r=e,(s=(i=(o=(a=String(r??"").replace(/^\uFEFF/,"").replace(/[\u0300-\u036f]/g,"").trim()).match(/^```(?:json)?\s*\n([\s\S]*?)\n```$/i))?o[1].trim():a).indexOf("{"),l=i.lastIndexOf("}"),-1===s||-1===l||l<=s?i:i.slice(s,l+1)).trim());try{n=u=JSON.parse(c),n?.tasks?.categories&&Array.isArray(n.tasks.categories)&&(n.tasks.categories=n.tasks.categories.map((e,t)=>{let r=S(e?.title??`Category ${t+1}`)||`Category ${t+1}`,a=(Array.isArray(e?.tasks)?e.tasks:[]).map((e,r)=>(function(e,t,r){if("string"==typeof r){let a=S(r);return{id:k(`c${e+1}t${t+1}`,1),title:a,metricKey:E(e,t),variants:T(a,null)}}let a=S(r?.title??r?.name??r?.text??"");return{id:S(r?.id)||k(`c${e+1}t${t+1}`,1),title:a||"Task",metricKey:S(r?.metricKey)||E(e,t),variants:T(a||"Task",r?.variants)}})(t,r,e));return{...e,title:r,tasks:a}}))}catch(t){return{ok:!1,error:"INVALID_JSON",details:String(t?.message??t),debug:{rawStart:String(e??"").slice(0,120),normalizedStart:c.slice(0,120),foundRootKeys:[]}}}let d=(u=function(e){let t,r=function(e){if(!Array.isArray(e?.groups)||e?.tasks)return e;let t=e.groups.filter(e=>"string"==typeof e&&e.trim()),r=Array.isArray(e?.tasks)?e.tasks:[];return e.categories=t.map((e,t)=>({id:`cat-${t+1}`,title:e,tasks:r})),e}({...e});if(!r.tasks&&Array.isArray(r.categories)&&(r.tasks={pickPerCategory:3,categories:r.categories.map((e,t)=>{let r=Array.isArray(e?.tasks)?e.tasks:[];return{key:String(e?.id||e?.key||`cat-${t+1}`),title:String(e?.title||`Kateg\xf3ria ${t+1}`),pool:r.map((e,r)=>{let a=e?.variants||{};return{id:String(e?.id||`t${t+1}-${r+1}`),title:String(e?.title||`\xdaloha ${r+1}`),metricKey:String(e?.metricKey||e?.id||`m_${t+1}_${r+1}`),variants:[{when:{lte:33},text:String(a?.lte||"")},{when:{between:[34,66]},text:String(a?.between||"")},{when:{gte:67},text:String(a?.gte||"")}]}})}})}),r.title&&"string"==typeof r.title&&r.title.trim()||(Array.isArray(r.groups)&&r.groups.length>0?r.title=String(r.groups[0]||"").trim()||"Generovaná edícia":Array.isArray(r.categories)&&r.categories.length>0?r.title=String(r.categories[0]?.title||"").trim()||"Generovaná edícia":r.title="Generovaná edícia"),r.slug&&"string"==typeof r.slug&&r.slug.trim()||(t=String(r.title||"generated-edition").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,64),r.slug=/^[a-z0-9][a-z0-9-]{1,62}[a-z0-9]$/.test(t)?t:"generated-edition"),(!r.content||"object"!=typeof r.content||Array.isArray(r.content))&&(r.content={heroTitle:String(r.title||r.slug||"Edícia"),heroSubtitle:"Personalizovaný prehľad",intro:{title:"Úvod",text:"Vyplň krátky formulár a získaj výsledok."},form:{title:"Vyhodnotenie",nameLabel:"Meno",birthDateLabel:"Dátum narodenia",submitLabel:"Vyhodnotiť"},result:{teaserTitle:"Náhľad",teaserNote:"Zobrazený je len teaser.",unlockHint:"Odomkni celý výsledok."},paywall:{headline:"Odomkni celý výsledok",bullets:["Všetky kategórie","Plný text","Personalizované výstupy"],cta:"Pokračovať na platbu"}}),r.engine&&"object"==typeof r.engine||(r.engine={subject:String(r.slug||"edition").replace(/-/g,"_"),locale:"sk"}),r.tasks&&Array.isArray(r.tasks.categories)){let e,t=e=>String(e??"").trim(),a=(e,r)=>{if(Array.isArray(e)&&e.every(e=>"object"==typeof e?.when&&"string"==typeof e?.text)){let t=e.slice(0,3);if(3===t.length)return t}let a=[];Array.isArray(e)?a=e.map(t):e&&"object"==typeof e&&(a=[t(e.lte),t(e.between),t(e.gte)]);let i=t(r)||"Task",[n,o,s]=(e=>{let t=e.filter(Boolean);if(0===t.length)return["","",""];for(;t.length<3;)t.push(t[t.length-1]);return t.slice(0,3)})(a.length?a:[i,i,i]);return[{when:{lte:33},text:n||i},{when:{between:[34,66]},text:o||n||i},{when:{gte:67},text:s||o||n||i}]};r.tasks={...r.tasks,pickPerCategory:(e=Number(r.tasks.pickPerCategory),Number.isFinite(e)?Math.max(1,Math.min(5,Math.floor(e))):3),categories:r.tasks.categories.map((e,r)=>{let i=String(e?.key||e?.id||`cat-${r+1}`),n=String(e?.title||`Kateg\xf3ria ${r+1}`);return{key:i,title:n,pool:(Array.isArray(e?.pool)?e.pool:Array.isArray(e?.tasks)?e.tasks:[]).map((e,i)=>{if("string"==typeof e){let n=t(e);return{id:`t${r+1}-${i+1}`,title:n||`Task ${i+1}`,metricKey:`m_${r+1}_${i+1}`,variants:a([n],n||`Task ${i+1}`)}}let n=String(e?.title??e?.name??e?.text??`Task ${i+1}`),o=e&&"object"==typeof e&&"variants"in e?e.variants:e;return{id:String(e?.id||`t${r+1}-${i+1}`),title:String(n),metricKey:String(e?.metricKey||`m_${r+1}_${i+1}`),variants:a(o,n)}})}})}}return r}(u))&&"object"==typeof u&&!Array.isArray(u)?Object.keys(u):[];if(!u||"object"!=typeof u||Array.isArray(u))return{ok:!1,error:"NOT_OBJECT",debug:{foundRootKeys:d,normalizedStart:c.slice(0,120)}};if("string"!=typeof u.slug||!u.slug.trim())return{ok:!1,error:"MISSING_SLUG",debug:{foundRootKeys:d,normalizedStart:c.slice(0,120)}};if("string"!=typeof u.title||!u.title.trim())return{ok:!1,error:"MISSING_TITLE",debug:{foundRootKeys:d,normalizedStart:c.slice(0,120)}};if(!u.content||"object"!=typeof u.content||Array.isArray(u.content))return{ok:!1,error:"MISSING_CONTENT_OBJECT",debug:{foundRootKeys:d,normalizedStart:c.slice(0,120)}};let p=u.slug.trim();if(!/^[a-z0-9][a-z0-9-]{1,62}[a-z0-9]$/.test(p))return{ok:!1,error:"BAD_SLUG",details:p,debug:{foundRootKeys:d,normalizedStart:c.slice(0,120)}};if(t.includes(p))return{ok:!1,error:"DUPLICATE_SLUG",details:p,debug:{foundRootKeys:d,normalizedStart:c.slice(0,120)}};if(void 0!==u.tasks){let e=u.tasks;if(!e||"object"!=typeof e||Array.isArray(e))return{ok:!1,error:"TASKS_NOT_OBJECT",debug:{foundRootKeys:d}};let t=Number(e.pickPerCategory??3);if(!Number.isFinite(t)||t<1||t>5)return{ok:!1,error:"TASKS_PICK_OUT_OF_RANGE",details:e.pickPerCategory,debug:{foundRootKeys:d}};if(!Array.isArray(e.categories)||5!==e.categories.length)return{ok:!1,error:"TASKS_NOT_5_CATEGORIES",details:Array.isArray(e.categories)?e.categories.length:null,debug:{foundRootKeys:d}};for(let r=0;r<e.categories.length;r++){let a=e.categories[r],i=Array.isArray(a?.pool)?a.pool:Array.isArray(a?.tasks)?a.tasks:null;if(!Array.isArray(i))return{ok:!1,error:"CATEGORY_POOL_MISSING",details:`cat#${r+1}`,debug:{foundRootKeys:d}};let n=Math.max(5,Math.floor(t));if(i.length<n)return{ok:!1,error:"CATEGORY_POOL_TOO_SMALL",details:`cat#${r+1} len=${i.length} (min ${n})`,debug:{foundRootKeys:d}};for(let e=0;e<i.length;e++){let t=i[e];if("string"!=typeof t?.id||!t.id.trim())return{ok:!1,error:"TASK_ID_MISSING",details:`cat#${r+1} task#${e+1}`};if("string"!=typeof t?.title||!t.title.trim())return{ok:!1,error:"TASK_TITLE_MISSING",details:`cat#${r+1} task#${e+1}`};if("string"!=typeof t?.metricKey||!t.metricKey.trim())return{ok:!1,error:"TASK_METRICKEY_MISSING",details:`cat#${r+1} task#${e+1}`};let a=Array.isArray(t?.variants)?t.variants:null;if(!a||3!==a.length)return{ok:!1,error:"TASK_VARIANTS_NOT_3",details:`cat#${r+1} task#${e+1}`};let n=a.some(e=>"number"==typeof e?.when?.lte&&"string"==typeof e?.text),o=a.some(e=>Array.isArray(e?.when?.between)&&2===e.when.between.length&&"string"==typeof e?.text),s=a.some(e=>"number"==typeof e?.when?.gte&&"string"==typeof e?.text);if(!n||!o||!s)return{ok:!1,error:"TASK_VARIANTS_BAD_SHAPE",details:`cat#${r+1} task#${e+1}`}}}}return{ok:!0,obj:{...u,slug:p,title:u.title.trim()}}}(u,c);if(!d.ok)return A.NextResponse.json({ok:!1,error:d.error,details:d.details,debug:d.debug},{status:400});let p=(process.env.GITHUB_TOKEN||"").trim();if(p){let{owner:e,repo:t}=function(){let e=(process.env.GITHUB_REPO||"").trim(),t=(process.env.GITHUB_OWNER||"").trim();if(e.includes("/")){let[t,r]=e.split("/").map(e=>e.trim()).filter(Boolean);if(t&&r)return{owner:t,repo:r}}if(t&&e)return{owner:t,repo:e};throw Error("Missing env: GITHUB_REPO (use <owner>/<repo> or set GITHUB_OWNER + GITHUB_REPO)")}(),r=(process.env.GITHUB_REF||"main").trim(),{slug:a}=await _({owner:e,repo:t,token:p,ref:r,edition:d.obj}),i=`https://github.com/${e}/${t}/blob/${r}/apps/nevedelE/data/editions.json`,n=`https://github.com/${e}/${t}/blob/${r}/apps/nevedelE/data/editions/${encodeURIComponent(a)}.json`;return A.NextResponse.json({ok:!0,slug:a,mode:"github-contents-only",indexUrl:i,editionUrl:n,message:"Edition persisted directly to GitHub (no Actions)."},{status:200})}let{slug:g}=(t=d.obj,r=new Date().toISOString(),a={...t,createdAt:t.createdAt||r,updatedAt:r},(0,b.persistEditionLocally)(a),{slug:String(a.slug)});return A.NextResponse.json({ok:!0,slug:g,mode:"local",message:"Edition persisted to local repo data."},{status:200})}catch(e){return A.NextResponse.json({ok:!1,error:"INTERNAL_ERROR",message:String(e?.message??e)},{status:500})}}e.s(["POST",()=>w,"dynamic",0,"force-dynamic"],54617);var N=e.i(54617);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/factory/dispatch/route",pathname:"/api/factory/dispatch",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/nevedelE/app/api/factory/dispatch/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:x,workUnitAsyncStorage:I,serverHooks:C}=O;function P(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:I})}async function j(e,t,a){O.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/factory/dispatch/route";A=A.replace(/\/index$/,"")||"/";let S=await O.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!S)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:k,params:E,nextConfig:T,parsedUrl:b,isDraftMode:v,prerenderManifest:R,routerServerContext:$,isOnDemandRevalidate:_,revalidateOnlyGenerated:w,resolvedPathname:N,clientReferenceManifest:x,serverActionsManifest:I}=S,C=(0,s.normalizeAppPath)(A),P=!!(R.dynamicRoutes[C]||R.routes[N]),j=async()=>((null==$?void 0:$.render404)?await $.render404(e,t,b,!1):t.end("This page could not be found"),null);if(P&&!v){let e=!!R.routes[N],t=R.dynamicRoutes[C];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await j();throw new h.NoFallbackError}}let U=null;!P||O.isDev||v||(U="/index"===(U=N)?"/":U);let K=!0===O.isDev||!P,G=P&&!K;I&&x&&(0,o.setManifestsSingleton)({page:A,clientReferenceManifest:x,serverActionsManifest:I});let H=e.method||"GET",M=(0,n.getTracer)(),D=M.getActiveScopeSpan(),B={params:E,prerenderManifest:R,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:K,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,i)=>O.onRequestError(e,t,a,i,$)},sharedContext:{buildId:k}},L=new l.NodeNextRequest(e),F=new l.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let o=async e=>O.handle(z,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${A}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&_&&w&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!P)return await (0,p.sendResponse)(L,F,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[y.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:_})},!1,$),t}},c=await O.handleResponse({req:e,nextConfig:T,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:w,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:s});if(!P)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",_?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),v&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&P||h.delete(y.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(L,F,new Response(c.value.body,{headers:h,status:c.value.status||200})),null};D?await l(D):await M.withPropagatedContext(e.headers,()=>M.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${A}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:C,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:_})},!1,$),P)throw t;return await (0,p.sendResponse)(L,F,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>P,"routeModule",()=>O,"serverHooks",()=>C,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>I],68404)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_55ec2894.js.map