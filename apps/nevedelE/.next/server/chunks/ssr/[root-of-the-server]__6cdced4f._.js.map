{"version":3,"sources":["../../../../../../apps/nevedelE/lib/editions-store.ts","../../../../../../packages/coso-factory-ui/src/builder-ui.tsx/__nextjs-internal-proxy.mjs","../../../../../../packages/coso-factory-ui/src/index.ts","../../../../../../apps/nevedelE/app/builder/page.tsx"],"sourcesContent":["import fs from \"node:fs\";\nimport path from \"node:path\";\n\nexport type EditionIndexEntry = { slug: string; title: string; createdAt?: string; updatedAt?: string };\nexport type EditionDocument = {\n  slug: string;\n  title: string;\n  createdAt?: string;\n  updatedAt?: string;\n  engine?: { subject?: string; locale?: \"sk\" | \"cz\" | \"en\" };\n  content?: Record<string, any>;\n  tasks?: any;\n};\n\nfunction readJsonNoBom(filePath: string) {\n  return JSON.parse(fs.readFileSync(filePath, \"utf8\").replace(/^\\uFEFF/, \"\"));\n}\n\nfunction resolveDataRoot() {\n  const cwd = process.cwd();\n  const envRoot = (process.env.EDITIONS_ROOT || \"\").trim();\n  const roots = [\n    ...(envRoot ? [envRoot] : []),\n    cwd,\n    path.resolve(cwd, \"..\"),\n    path.resolve(cwd, \"..\", \"..\"),\n  ];\n\n  for (const root of roots) {\n    const direct = path.join(root, \"data\", \"editions.json\");\n    if (fs.existsSync(direct)) return path.join(root, \"data\");\n\n    const appScoped = path.join(root, \"apps\", \"nevedelE\", \"data\", \"editions.json\");\n    if (fs.existsSync(appScoped)) return path.join(root, \"apps\", \"nevedelE\", \"data\");\n  }\n\n  return path.join(cwd, \"data\");\n}\n\nexport function getDataPaths() {\n  const dataRoot = resolveDataRoot();\n  return {\n    dataRoot,\n    indexPath: path.join(dataRoot, \"editions.json\"),\n    editionsDir: path.join(dataRoot, \"editions\"),\n  };\n}\n\nexport function persistEditionLocally(edition: EditionDocument): void {\n  const { indexPath, editionsDir } = getDataPaths();\n  fs.mkdirSync(editionsDir, { recursive: true });\n\n  const now = new Date().toISOString();\n  const normalizedEdition = { ...edition, createdAt: edition.createdAt || now, updatedAt: edition.updatedAt || now };\n\n  const edPath = path.join(editionsDir, `${edition.slug}.json`);\n  fs.writeFileSync(edPath, JSON.stringify(normalizedEdition, null, 2) + \"\\n\", \"utf8\");\n\n  let idx: { editions: EditionIndexEntry[] } = { editions: [] };\n  if (fs.existsSync(indexPath)) {\n    idx = readJsonNoBom(indexPath);\n  }\n  if (!Array.isArray(idx.editions)) idx.editions = [];\n\n  const existingIndex = idx.editions.findIndex((e) => e?.slug === edition.slug);\n  if (existingIndex === -1) {\n    idx.editions.unshift({\n      slug: edition.slug,\n      title: edition.title,\n      createdAt: normalizedEdition.createdAt,\n      updatedAt: normalizedEdition.updatedAt\n    });\n  } else {\n    idx.editions[existingIndex] = {\n      ...idx.editions[existingIndex],\n      slug: edition.slug,\n      title: edition.title,\n      createdAt: idx.editions[existingIndex]?.createdAt || normalizedEdition.createdAt,\n      updatedAt: normalizedEdition.updatedAt\n    };\n  }\n\n  fs.writeFileSync(indexPath, JSON.stringify(idx, null, 2) + \"\\n\", \"utf8\");\n}\n\nexport function listEditions(): EditionIndexEntry[] {\n  const { indexPath, editionsDir } = getDataPaths();\n\n  try {\n    const idx = readJsonNoBom(indexPath);\n    if (Array.isArray(idx?.editions)) {\n      return idx.editions\n        .filter((e: any) => e && typeof e.slug === \"string\" && typeof e.title === \"string\")\n        .map((e: any) => ({ slug: e.slug, title: e.title, createdAt: e.createdAt, updatedAt: e.updatedAt }));\n    }\n  } catch {\n    // fallback below\n  }\n\n  if (!fs.existsSync(editionsDir)) return [];\n\n  return fs\n    .readdirSync(editionsDir)\n    .filter((name) => name.endsWith(\".json\"))\n    .map((name) => {\n      const doc = readJsonNoBom(path.join(editionsDir, name));\n      return {\n        slug: String(doc.slug || name.replace(/\\.json$/, \"\")),\n        title: String(doc.title || doc.slug || name),\n        createdAt: typeof doc.createdAt === \"string\" ? doc.createdAt : undefined,\n        updatedAt: typeof doc.updatedAt === \"string\" ? doc.updatedAt : undefined,\n      } as EditionIndexEntry;\n    });\n}\n\nexport function loadEditionBySlug(slug: string): EditionDocument | null {\n  const safeSlug = String(slug || \"\").trim();\n  if (!safeSlug) return null;\n\n  const { editionsDir } = getDataPaths();\n  const filePath = path.join(editionsDir, `${safeSlug}.json`);\n  if (!fs.existsSync(filePath)) return null;\n\n  try {\n    return readJsonNoBom(filePath) as EditionDocument;\n  } catch {\n    return null;\n  }\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/packages/coso-factory-ui/src/builder-ui.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/packages/coso-factory-ui/src/builder-ui.tsx\",\n    \"default\",\n);\n","import { createElement } from \"react\";\nimport BuilderUI from \"./builder-ui\";\nimport type { EditionIndexEntry } from \"./types\";\n\nexport type { EditionIndexEntry };\nexport default BuilderUI;\n\nexport function FactoryBuilder({ editions }: { editions: EditionIndexEntry[] }) {\n  return createElement(BuilderUI, { editions });\n}\n","import BuilderUi from \"./ui\";\nimport { listEditions } from \"../../lib/editions-store\";\n\nexport const dynamic = \"force-dynamic\";\n\nexport default function Page() {\n  const editions = listEditions();\n  return <BuilderUi editions={editions} />;\n}\n"],"names":[],"mappings":"0cAAA,IAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAaA,SAAS,EAAc,CAAgB,EACrC,OAAO,KAAK,KAAK,CAAC,EAAA,OAAE,CAAC,YAAY,CAAC,EAAU,QAAQ,OAAO,CAAC,UAAW,IACzE,CAuBO,SAAS,IACd,IAAM,EAAW,AAtBnB,SAAS,EACP,IAAM,EAAM,QAAQ,GAAG,GACjB,EAAU,CAAC,QAAQ,GAAG,CAAC,aAAa,EAAI,EAAA,CAAE,CAAE,IAAI,GAQtD,IAAK,IAAM,IAPG,IAOK,AANb,EAAU,CAAC,EAAQ,CAAG,EAAE,CAC5B,EACA,EAAA,OAAI,CAAC,OAAO,CAAC,EAAK,MAClB,EAAA,OAAI,CAAC,OAAO,CAAC,EAAK,KAAM,MACzB,CAEyB,CACxB,IAAM,EAAS,EAAA,OAAI,CAAC,IAAI,CAAC,EAAM,OAAQ,iBACvC,GAAI,EAAA,OAAE,CAAC,UAAU,CAAC,GAAS,OAAO,EAAA,OAAI,CAAC,IAAI,CAAC,EAAM,QAElD,IAAM,EAAY,EAAA,OAAI,CAAC,IAAI,CAAC,EAAM,OAAQ,WAAY,OAAQ,iBAC9D,GAAI,EAAA,OAAE,CAAC,UAAU,CAAC,GAAY,OAAO,EAAA,OAAI,CAAC,IAAI,CAAC,EAAM,OAAQ,WAAY,OAC3E,CAEA,OAAO,EAAA,OAAI,CAAC,IAAI,CAAC,EAAK,OACxB,IAIE,MAAO,CACL,WACA,UAAW,EAAA,OAAI,CAAC,IAAI,CAAC,EAAU,iBAC/B,YAAa,EAAA,OAAI,CAAC,IAAI,CAAC,EAAU,WACnC,CACF,CAuCO,SAAS,IACd,GAAM,WAAE,CAAS,aAAE,CAAW,CAAE,CAAG,IAEnC,GAAI,CACF,IAAM,EAAM,EAAc,GAC1B,GAAI,MAAM,OAAO,CAAC,GAAK,UACrB,CADgC,MACzB,EAAI,QAAQ,CAChB,MAAM,CAAC,AAAC,GAAW,GAAuB,UAAlB,OAAO,EAAE,IAAI,EAAoC,UAAnB,OAAO,EAAE,KAAK,EACpE,GAAG,CAAE,AAAD,GAAa,CAAD,CAAG,KAAM,EAAE,IAAI,CAAE,MAAO,EAAE,KAAK,CAAE,UAAW,EAAE,SAAS,CAAE,UAAW,EAAE,SAAS,CAAC,CAAC,CAExG,CAAE,KAAM,CAER,QAEA,AAAK,EAAA,EAAD,KAAG,CAAC,UAAU,CAAC,GAEZ,EAAA,OAAE,CACN,CAH8B,UAGnB,CAAC,GACZ,MAAM,CAAC,AAAC,GAAS,EAAK,QAAQ,CAAC,UAC/B,GAAG,CAAC,AAAC,IACJ,IAAM,EAAM,EAAc,EAAA,OAAI,CAAC,IAAI,CAAC,EAAa,IACjD,MAAO,CACL,KAAM,OAAO,EAAI,IAAI,EAAI,EAAK,OAAO,CAAC,UAAW,KACjD,MAAO,OAAO,EAAI,KAAK,EAAI,EAAI,IAAI,EAAI,GACvC,UAAoC,UAAzB,OAAO,EAAI,SAAS,CAAgB,EAAI,SAAS,CAAG,OAC/D,UAAoC,UAAzB,OAAO,EAAI,SAAS,CAAgB,EAAI,SAAS,MAAG,CACjE,CACF,GAbsC,EAc1C,AAd4C,CAgBrC,SAAS,EAAkB,CAAY,EAC5C,IAAM,EAAW,OAAO,GAAQ,IAAI,IAAI,GACxC,GAAI,CAAC,EAAU,OAAO,KAEtB,GAAM,CAAE,aAAW,CAAE,CAAG,IAClB,EAAW,EAAA,OAAI,CAAC,IAAI,CAAC,EAAa,CAAA,EAAG,EAAS,KAAK,CAAC,EAC1D,GAAI,CAAC,EAAA,OAAE,CAAC,UAAU,CAAC,GAAW,OAAO,KAErC,GAAI,CACF,OAAO,EAAc,EACvB,CAAE,KAAM,CACN,OAAO,IACT,CACF,4GC9He,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,6SAA+S,EAC5U,4EACA,gEAHW,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,yRAA2R,EACxT,wDACA,8GCLJ,EAAA,EAAA,CAAA,CAAA,KACA,EAAA,EAAA,CAAA,CAAA,OAMO,SAAS,EAAe,UAAE,CAAQ,CAAqC,EAC5E,MAAO,CAAA,EAAA,EAAA,aAAA,AAAa,EAAC,EAAA,OAAS,CAAE,UAAE,CAAS,EAC7C,CAJe,EAAA,OAAS,CCJxB,IAAA,EAAA,EAAA,CAAA,CAAA,OAIe,SAAS,IACtB,IAAM,EAAW,CAAA,EAAA,EAAA,YAAA,AAAY,IAC7B,MAAO,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAU,SAAU,GAC9B,kCALuB","ignoreList":[1]}