module.exports=[78550,a=>{"use strict";var b=a.i(87924),c=a.i(72131);function d(a){return String(a??"").trim()}function e(a,b){return`${a}-${String(b).padStart(3,"0")}`}function f(a,b){return`c${a+1}_t${b+1}`}function g(a,b){let c=d(a)||"Task",e=Array.isArray(b)?b.map(d).filter(Boolean):[];for(0===e.length&&(e=[c,c+" (quick)",c+" (deep)"]);e.length<3;)e.push(e[e.length-1]);return e.length>3&&(e=e.slice(0,3)),e}function h(a){let b,c=function(a){if(!Array.isArray(a?.groups)||a?.tasks)return a;let b=a.groups.filter(a=>"string"==typeof a&&a.trim()),c=Array.isArray(a?.tasks)?a.tasks:[];return a.categories=b.map((a,b)=>({id:`cat-${b+1}`,title:a,tasks:c})),a}({...a});if(!c.tasks&&Array.isArray(c.categories)&&(c.tasks={pickPerCategory:3,categories:c.categories.map((a,b)=>{let c=Array.isArray(a?.tasks)?a.tasks:[];return{key:String(a?.id||a?.key||`cat-${b+1}`),title:String(a?.title||`Kateg\xf3ria ${b+1}`),pool:c.map((a,c)=>{let d=a?.variants||{};return{id:String(a?.id||`t${b+1}-${c+1}`),title:String(a?.title||`\xdaloha ${c+1}`),metricKey:String(a?.metricKey||a?.id||`m_${b+1}_${c+1}`),variants:[{when:{lte:33},text:String(d?.lte||"")},{when:{between:[34,66]},text:String(d?.between||"")},{when:{gte:67},text:String(d?.gte||"")}]}})}})}),c.title&&"string"==typeof c.title&&c.title.trim()||(Array.isArray(c.groups)&&c.groups.length>0?c.title=String(c.groups[0]||"").trim()||"Generovaná edícia":Array.isArray(c.categories)&&c.categories.length>0?c.title=String(c.categories[0]?.title||"").trim()||"Generovaná edícia":c.title="Generovaná edícia"),c.slug&&"string"==typeof c.slug&&c.slug.trim()||(b=String(c.title||"generated-edition").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,64),c.slug=/^[a-z0-9][a-z0-9-]{1,62}[a-z0-9]$/.test(b)?b:"generated-edition"),(!c.content||"object"!=typeof c.content||Array.isArray(c.content))&&(c.content={heroTitle:String(c.title||c.slug||"Edícia"),heroSubtitle:"Personalizovaný prehľad",intro:{title:"Úvod",text:"Vyplň krátky formulár a získaj výsledok."},form:{title:"Vyhodnotenie",nameLabel:"Meno",birthDateLabel:"Dátum narodenia",submitLabel:"Vyhodnotiť"},result:{teaserTitle:"Náhľad",teaserNote:"Zobrazený je len teaser.",unlockHint:"Odomkni celý výsledok."},paywall:{headline:"Odomkni celý výsledok",bullets:["Všetky kategórie","Plný text","Personalizované výstupy"],cta:"Pokračovať na platbu"}}),c.engine&&"object"==typeof c.engine||(c.engine={subject:String(c.slug||"edition").replace(/-/g,"_"),locale:"sk"}),c.tasks&&Array.isArray(c.tasks.categories)){let a,b=a=>String(a??"").trim(),d=(a,c)=>{if(Array.isArray(a)&&a.every(a=>"object"==typeof a?.when&&"string"==typeof a?.text)){let b=a.slice(0,3);if(3===b.length)return b}let d=[];Array.isArray(a)?d=a.map(b):a&&"object"==typeof a&&(d=[b(a.lte),b(a.between),b(a.gte)]);let e=b(c)||"Task",[f,g,h]=(a=>{let b=a.filter(Boolean);if(0===b.length)return["","",""];for(;b.length<3;)b.push(b[b.length-1]);return b.slice(0,3)})(d.length?d:[e,e,e]);return[{when:{lte:33},text:f||e},{when:{between:[34,66]},text:g||f||e},{when:{gte:67},text:h||g||f||e}]};c.tasks={...c.tasks,pickPerCategory:Number.isFinite(a=Number(c.tasks.pickPerCategory))?Math.max(1,Math.min(5,Math.floor(a))):3,categories:c.tasks.categories.map((a,c)=>{let e=String(a?.key||a?.id||`cat-${c+1}`);return{key:e,title:String(a?.title||`Kateg\xf3ria ${c+1}`),pool:(Array.isArray(a?.pool)?a.pool:Array.isArray(a?.tasks)?a.tasks:[]).map((a,e)=>{if("string"==typeof a){let f=b(a);return{id:`t${c+1}-${e+1}`,title:f||`Task ${e+1}`,metricKey:`m_${c+1}_${e+1}`,variants:d([f],f||`Task ${e+1}`)}}let f=String(a?.title??a?.name??a?.text??`Task ${e+1}`),g=a&&"object"==typeof a&&"variants"in a?a.variants:a;return{id:String(a?.id||`t${c+1}-${e+1}`),title:String(f),metricKey:String(a?.metricKey||`m_${c+1}_${e+1}`),variants:d(g,f)}})}})}}return c}function i(a){var b,c;let d,e,f;return(e=(c=(d=(b=String(a??"").replace(/^\uFEFF/,"").replace(/[\u0300-\u036f]/g,"").trim()).match(/^```(?:json)?\s*\n([\s\S]*?)\n```$/i))?d[1].trim():b).indexOf("{"),f=c.lastIndexOf("}"),-1===e||-1===f||f<=e?c:c.slice(e,f+1)).trim()}function j(a,b=[]){let c,k=i(a);try{var l;l=c=JSON.parse(k),l?.tasks?.categories&&Array.isArray(l.tasks.categories)&&(l.tasks.categories=l.tasks.categories.map((a,b)=>{let c=d(a?.title??`Category ${b+1}`)||`Category ${b+1}`,h=(Array.isArray(a?.tasks)?a.tasks:[]).map((a,c)=>(function(a,b,c){if("string"==typeof c){let h=d(c);return{id:e(`c${a+1}t${b+1}`,1),title:h,metricKey:f(a,b),variants:g(h,null)}}let h=d(c?.title??c?.name??c?.text??"");return{id:d(c?.id)||e(`c${a+1}t${b+1}`,1),title:h||"Task",metricKey:d(c?.metricKey)||f(a,b),variants:g(h||"Task",c?.variants)}})(b,c,a));return{...a,title:c,tasks:h}}))}catch(b){return{ok:!1,error:"INVALID_JSON",details:String(b?.message??b),debug:{rawStart:String(a??"").slice(0,120),normalizedStart:k.slice(0,120),foundRootKeys:[]}}}let m=(c=h(c))&&"object"==typeof c&&!Array.isArray(c)?Object.keys(c):[];if(!c||"object"!=typeof c||Array.isArray(c))return{ok:!1,error:"NOT_OBJECT",debug:{foundRootKeys:m,normalizedStart:k.slice(0,120)}};if("string"!=typeof c.slug||!c.slug.trim())return{ok:!1,error:"MISSING_SLUG",debug:{foundRootKeys:m,normalizedStart:k.slice(0,120)}};if("string"!=typeof c.title||!c.title.trim())return{ok:!1,error:"MISSING_TITLE",debug:{foundRootKeys:m,normalizedStart:k.slice(0,120)}};if(!c.content||"object"!=typeof c.content||Array.isArray(c.content))return{ok:!1,error:"MISSING_CONTENT_OBJECT",debug:{foundRootKeys:m,normalizedStart:k.slice(0,120)}};let n=c.slug.trim();if(!/^[a-z0-9][a-z0-9-]{1,62}[a-z0-9]$/.test(n))return{ok:!1,error:"BAD_SLUG",details:n,debug:{foundRootKeys:m,normalizedStart:k.slice(0,120)}};if(b.includes(n))return{ok:!1,error:"DUPLICATE_SLUG",details:n,debug:{foundRootKeys:m,normalizedStart:k.slice(0,120)}};if(void 0!==c.tasks){let a=c.tasks;if(!a||"object"!=typeof a||Array.isArray(a))return{ok:!1,error:"TASKS_NOT_OBJECT",debug:{foundRootKeys:m}};let b=Number(a.pickPerCategory??3);if(!Number.isFinite(b)||b<1||b>5)return{ok:!1,error:"TASKS_PICK_OUT_OF_RANGE",details:a.pickPerCategory,debug:{foundRootKeys:m}};if(!Array.isArray(a.categories)||5!==a.categories.length)return{ok:!1,error:"TASKS_NOT_5_CATEGORIES",details:Array.isArray(a.categories)?a.categories.length:null,debug:{foundRootKeys:m}};for(let c=0;c<a.categories.length;c++){let d=a.categories[c],e=Array.isArray(d?.pool)?d.pool:Array.isArray(d?.tasks)?d.tasks:null;if(!Array.isArray(e))return{ok:!1,error:"CATEGORY_POOL_MISSING",details:`cat#${c+1}`,debug:{foundRootKeys:m}};let f=Math.max(5,Math.floor(b));if(e.length<f)return{ok:!1,error:"CATEGORY_POOL_TOO_SMALL",details:`cat#${c+1} len=${e.length} (min ${f})`,debug:{foundRootKeys:m}};for(let a=0;a<e.length;a++){let b=e[a];if("string"!=typeof b?.id||!b.id.trim())return{ok:!1,error:"TASK_ID_MISSING",details:`cat#${c+1} task#${a+1}`};if("string"!=typeof b?.title||!b.title.trim())return{ok:!1,error:"TASK_TITLE_MISSING",details:`cat#${c+1} task#${a+1}`};if("string"!=typeof b?.metricKey||!b.metricKey.trim())return{ok:!1,error:"TASK_METRICKEY_MISSING",details:`cat#${c+1} task#${a+1}`};let d=Array.isArray(b?.variants)?b.variants:null;if(!d||3!==d.length)return{ok:!1,error:"TASK_VARIANTS_NOT_3",details:`cat#${c+1} task#${a+1}`};let f=d.some(a=>"number"==typeof a?.when?.lte&&"string"==typeof a?.text),g=d.some(a=>Array.isArray(a?.when?.between)&&2===a.when.between.length&&"string"==typeof a?.text),h=d.some(a=>"number"==typeof a?.when?.gte&&"string"==typeof a?.text);if(!f||!g||!h)return{ok:!1,error:"TASK_VARIANTS_BAD_SHAPE",details:`cat#${c+1} task#${a+1}`}}}}return{ok:!0,obj:{...c,slug:n,title:c.title.trim()}}}function k(a){return['ROLE: Si generator edicii pre COSO Factory (Next.js app).\n\nVYSTUP:\n- Vrat presne 1 JSON objekt (ziadny markdown, ziadne komentare, ziadny dalsi text).\n- Musi to byt strict JSON (dvojite uvodzovky, ziadne trailing commas).\n\nCIEĽ:\n- Vymysli novu koherentnu ediciu (tema, nazov, texty, tasky).\n- Musi to byt prakticke, bezpecne, pouzitelne ako denny sebareflexny nastroj.\n\nKONTEXT PRODUKTU:\n- Edicia je stranka na /e/<slug>.\n- Pouzivatel moze zadat meno a birthDate (YYYY-MM-DD) ako volitelne vstupy.\n- Full vysledok je za paywallom; bez platby je len teaser.\n\nHARD REQUIREMENTS:\n1) slug: lowercase-hyphen, 3-64 znakov, musi byt unikatny a NESMIE byt v zozname uz nasadenych slugov nizsie.\n2) engine.locale = "sk"\n3) engine.subject: snake_case, 3-40 znakov, tematicky suvisiace s ediciou.\n4) content: vypln vsetky polia realnym textom (ziadne "...").\n5) tasks:\n- pickPerCategory musi byt 3\n- categories musi byt presne 5 poloziek\n- kazda kategoria musi mat pool presne 30 task objektov\n- kazdy task objekt musi mat: id, title, metricKey, variants\n- variants musi byt presne 3 prvky v tomto tvare:\n  (1) { when: { lte: 33 }, text: "..." }\n  (2) { when: { between: [34,66] }, text: "..." }\n  (3) { when: { gte: 67 }, text: "..." }\n\nAKO TO NAVRHNUT, ABY TO DAVALO ZMYSEL:\n- Zvol jednu jasnu temu (napr. fokus, hranice, komunikacia, regeneracia, rozhodovanie).\n- Navrhni 5 kategorii, ktore spolu tvoria model (napr. Fokus, Energia, Hranice, Komunikacia, Obnova).\n- Pre kazdu kategoriu vytvor 30 mikro-uloch (konkretne, vykonatelne, bezpecne).\n- Pre kazdu ulohu napis 3 varianty textu podla skore:\n  lte (nizke skore): jemny start, minimal effort.\n  between (stred): udrziavaci krok, male zlepsenie.\n  gte (vysoke): narocnejsi/preciznejsi krok bez tlaku.\n- metricKey rob konzistentne: m_catX_tYY (napr. m_cat3_t14).\n\nBEZPECNOST:\n- Bez medicinskych diagnoz, bez terapeutickych tvrdeni, bez nelegalnych navodov.\n\nJSON SCHEMA (MUSI SEDIT S KLUCAMI):\n{\n  "slug": "...",\n  "title": "...",\n  "engine": { "subject": "...", "locale": "sk" },\n  "content": {\n    "heroTitle": "...",\n    "heroSubtitle": "...",\n    "intro": { "title": "...", "text": "..." },\n    "form": {\n      "title": "...",\n      "nameLabel": "Meno (volitelne)",\n      "birthDateLabel": "Datum narodenia (volitelne)",\n      "submitLabel": "Vyhodnotit"\n    },\n    "result": {\n      "teaserTitle": "...",\n      "teaserNote": "...",\n      "unlockHint": "..."\n    },\n    "paywall": {\n      "headline": "...",\n      "bullets": ["...", "...", "..."],\n      "cta": "Pokracovat na platbu"\n    }\n  },\n  "tasks": {\n    "pickPerCategory": 3,\n    "categories": [\n      {\n        "key": "cat-1",\n        "title": "...",\n        "pool": [\n          {\n            "id": "t1-01",\n            "title": "...",\n            "metricKey": "m_cat1_t01",\n            "variants": [\n              { "when": { "lte": 33 }, "text": "..." },\n              { "when": { "between": [34, 66] }, "text": "..." },\n              { "when": { "gte": 67 }, "text": "..." }\n            ]\n          }\n        ]\n      },\n      { "key": "cat-2", "title": "...", "pool": [ /* 30 task objects */ ] },\n      { "key": "cat-3", "title": "...", "pool": [ /* 30 task objects */ ] },\n      { "key": "cat-4", "title": "...", "pool": [ /* 30 task objects */ ] },\n      { "key": "cat-5", "title": "...", "pool": [ /* 30 task objects */ ] }\n    ]\n  }\n}\n\nFINAL SELF-CHECK (sprav potichu pred vystupom):\n- slug je unikatny vs deployed list?\n- categories ma presne 5?\n- pickPerCategory je 3?\n- kazda kategoria ma pool presne 30?\n- kazdy task ma variants presne 3 s lte/between/gte?\n- ziaden placeholder "..." vo finalnom JSON?\n\nAlready deployed editions (MUST AVOID):',a.map(a=>`- ${a}`).join("\n")||"- (none)"].join("\n")}function l({editions:a}){let[d,e]=(0,c.useState)(a.map(a=>a.slug)),f=(0,c.useMemo)(()=>k(d),[d]),[g,l]=(0,c.useState)(f),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)({kind:"idle",msg:""});async function q(){try{await navigator.clipboard.writeText(g),p({kind:"ok",msg:"Prompt copied."})}catch{p({kind:"err",msg:"Copy failed."})}}async function r(){p({kind:"idle",msg:"Starting factory workflow..."});try{let a=await fetch("/api/editions/slugs",{cache:"no-store"}),b=await a.json().catch(()=>null);if(!a.ok||!b?.ok||!Array.isArray(b?.slugs))return void p({kind:"err",msg:`Refresh failed: ${b?.error??a.status}`.trim()});let c=b.slugs.map(a=>String(a)).filter(Boolean);e(c),l(k(c)),p({kind:"ok",msg:`Refresh OK. Slugs loaded: ${c.length}`})}catch{p({kind:"err",msg:"Refresh failed."})}}async function s(){let a=j(m,d);if(!a.ok){let b=a?.debug??{},c=Array.isArray(b.foundRootKeys)?b.foundRootKeys:[],d=String(b.normalizedStart??"").replace(/\s+/g," ").trim();p({kind:"err",msg:`Neplatny JSON: ${a.error}${a.details?` (${a.details})`:""}; root keys: ${c.join(", ")||"(none)"}; normalized head: ${d}`});return}p({kind:"idle",msg:"Starting factory workflow..."});let b=await fetch("/api/factory/dispatch",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({edition:a.obj,rawEditionJson:m})}),c=await b.json().catch(()=>null);b.ok&&c?.ok?(p({kind:"ok",msg:"string"==typeof c?.message&&c.message.trim()?c.message.trim():`OK. Edition saved to repo. slug=${String(c?.slug??"").trim()}`}),n("")):p({kind:"err",msg:`Dispatch zlyhal: ${c?.error??b.status} ${c?.message??""}`.trim()})}return(0,b.jsx)("main",{className:"min-h-screen px-4 py-10 text-neutral-100",style:{backgroundImage:"url(/brand/bg.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:(0,b.jsxs)("div",{className:"mx-auto w-full max-w-4xl translate-y-6 rounded-2xl border border-neutral-800 bg-neutral-900/70 p-6 shadow-xl backdrop-blur",children:[(0,b.jsx)("div",{className:"mb-6 flex justify-center",children:(0,b.jsx)("img",{src:"/brand/logo.png",alt:"Brand",style:{height:120,width:"auto"}})}),(0,b.jsx)("h1",{className:"text-3xl font-semibold tracking-tight",children:"Factory Builder"}),(0,b.jsx)("p",{className:"mt-2 text-sm leading-6 text-neutral-200/80",children:"Prompt and list of editions (slugs) are used as input context."}),(0,b.jsxs)("section",{className:"mt-8 space-y-2",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"1) Prompt pre LLM"}),(0,b.jsx)("textarea",{value:g,onChange:a=>l(a.target.value),rows:18,className:"w-full rounded-xl border border-neutral-700 bg-neutral-950/80 p-3 font-mono text-sm leading-6 outline-none focus:border-neutral-500"}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap gap-3",children:[(0,b.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:q,children:"Copy prompt"}),(0,b.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:r,children:"Refresh"}),(0,b.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:()=>l(f),children:"Reset prompt"}),(0,b.jsx)("a",{href:"/list",className:"rounded-lg border border-neutral-200/40 bg-neutral-950/30 px-3 py-2 text-sm text-neutral-100",children:"View deployed editions"})]})]}),(0,b.jsxs)("section",{className:"mt-8 space-y-2",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"2) Paste LLM JSON and build the edition"}),(0,b.jsx)("textarea",{value:m,onChange:a=>n(a.target.value),rows:12,placeholder:"You can paste plain JSON, a `json ... ` block, or text that contains a JSON object.",className:"w-full rounded-xl border border-neutral-700 bg-neutral-950/80 p-3 font-mono text-sm leading-6 outline-none focus:border-neutral-500"}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap gap-3",children:[(0,b.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:()=>{let a=j(m,d);p(a.ok?{kind:"ok",msg:"JSON looks valid."}:{kind:"err",msg:`Invalid JSON: ${a.error}`})},children:"Validate"}),(0,b.jsx)("button",{className:"rounded-lg bg-emerald-300 px-3 py-2 text-sm font-semibold text-emerald-950",onClick:s,children:"Dispatch build"}),(0,b.jsx)("button",{className:"rounded-lg border border-neutral-200/40 bg-neutral-950/30 px-3 py-2 text-sm text-neutral-100",onClick:()=>{let a=function(a){let b=i(a);try{let a=JSON.parse(b),c=h(a);return JSON.stringify(c,null,2)}catch{return function(a){let b=String(a??""),c=b.indexOf("{");if(c<0)return null;let d=!1,e=!1,f=0;for(let a=c;a<b.length;a++){let g=b[a];if(d){if(e){e=!1;continue}if("\\"===g){e=!0;continue}'"'===g&&(d=!1);continue}if('"'===g){d=!0;continue}if("{"===g&&f++,"}"===g&&0==--f){let d=b.slice(c,a+1).trim();try{return JSON.parse(d),d}catch{}}}return null}(b)??b}}(m);n(a),p({kind:"ok",msg:`JSON normalized (${a.length} chars). Missing title/slug/content were auto-filled.`})},children:"Normalize JSON"})]}),o.msg&&(0,b.jsxs)("p",{className:`mt-3 rounded-xl border p-3 text-sm ${"err"===o.kind?"border-red-500 text-red-200":"ok"===o.kind?"border-green-500 text-green-200":"border-neutral-200/40 text-neutral-100"} bg-neutral-950/40`,children:[(0,b.jsxs)("strong",{children:["err"===o.kind?"Error":"ok"===o.kind?"OK":"Info",":"]})," ",o.msg]})]})]})})}a.s(["default",()=>l],78550)}];

//# sourceMappingURL=packages_coso-factory-ui_src_builder-ui_tsx_d217518d._.js.map