(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,r)=>{t.exports=e.r(76562)},82363,e=>{"use strict";var t=e.i(43476),r=e.i(71645),l=e.i(18566);function a(e){let t=(e||"").trim();if(!t)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;if(/^\d{2}\.\d{2}\.\d{4}$/.test(t)){let[e,r,l]=t.split(".");return`${l}-${r}-${e}`}return/^\d{8}$/.test(t)?`${t.slice(4,8)}-${t.slice(2,4)}-${t.slice(0,2)}`:t}function s(e,t){let r=a(t);return r?`${e}:${r}`:""}function n(e){return"low"===e?"Nízke":"mid"===e?"Stredné":"high"===e?"Vysoké":e||""}function i({slug:e,edition:i,previewMode:o=!1}){let d=i?.content??{},c=i?.engine?.locale??"sk",u=(0,l.useRouter)(),m=(0,l.usePathname)(),x=(0,l.useSearchParams)(),[p,h]=(0,r.useState)(""),[b,g]=(0,r.useState)(""),[f,j]=(0,r.useState)(""),[y,N]=(0,r.useState)(!1),[w,S]=(0,r.useState)(null),[v,$]=(0,r.useState)(!1),[k,P]=(0,r.useState)(!1),[C,U]=(0,r.useState)(null),E=y||o;function R(t,r){if(o)return;let l=a(t),n=(r||"").trim(),i=l?s(e,l):"",d=new URLSearchParams(x?.toString()??"");l?d.set("birthDate",l):d.delete("birthDate"),n?d.set("name",n):d.delete("name"),i?d.set("rid",i):d.delete("rid");let c=d.toString();u.replace(c?`${m}?${c}`:m,{scroll:!1})}function D(e,t){return`coso:result:${e}:${t}`}async function I(t,r){let l=a(t);if(!l)throw Error("Zadaj dátum narodenia.");let n=await fetch("/api/compute",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({editionSlug:e,name:(r||"").trim()||"",birthDate:l,locale:c})}),i=await n.json();if(!n.ok)throw Error(i?.error||"COMPUTE_FAILED");let o=i?.result??i,d=s(e,l);S(o),j(d);try{localStorage.setItem(D(e,l),JSON.stringify(o))}catch{}}(0,r.useEffect)(()=>{if(!o)try{let e=new URL(window.location.href),t=(e.searchParams.get("birthDate")||"").trim(),r=(e.searchParams.get("name")||"").trim(),l=(e.searchParams.get("rid")||"").trim();if(t&&g(t),r&&h(r),l){j(l);let[,e]=l.split(":",2);e&&/^\d{4}-\d{2}-\d{2}$/.test(e)&&g(e)}}catch{}},[o,e]),(0,r.useEffect)(()=>{try{let t=a(b);if(!t)return;let r=localStorage.getItem(D(e,t));r&&S(JSON.parse(r))}catch{}},[e,b]),(0,r.useEffect)(()=>{o||(async()=>{try{let t=new URL(window.location.href),r=(t.searchParams.get("session_id")||"").trim(),l=((t.searchParams.get("rid")||"").trim()||f||"").trim();if(!l)return;if(r){let a=await fetch(`/api/pay/status?session_id=${encodeURIComponent(r)}&rid=${encodeURIComponent(l)}&slug=${encodeURIComponent(e)}`,{cache:"no-store"}),s=await a.json();s?.paid&&N(!0),t.searchParams.delete("session_id"),window.history.replaceState({},"",t.toString());return}let a=await fetch(`/api/pay/status?rid=${encodeURIComponent(l)}&slug=${encodeURIComponent(e)}`,{cache:"no-store"}),s=await a.json();s?.paid&&N(!0)}catch{}})()},[o,f,e]),(0,r.useEffect)(()=>{if(k||w)return;let t=a(b);if(!t)return;let r=s(e,t);f&&f!==r||(async()=>{try{await I(t,p),R(t,p)}catch{}finally{P(!0)}})()},[k,b,p,w,f,e]);let O=(0,r.useMemo)(()=>w?.categories?.length?E?w:{categories:w.categories.slice(0,2).map(e=>({...e,items:(e.items??[]).slice(0,1).map(e=>({...e})),recommendation:void 0}))}:null,[w,E]);async function T(){U(null);try{R(b,p),await I(b,p)}catch(e){U(String(e?.message??e))}}async function L(){if(!o){U(null),$(!0);try{R(b,p);let t=a(b),r=(f||s(e,t)).trim();if(!r)throw Error("Najprv vyplň dátum narodenia a vyhodnoť výsledok.");let l=(p||"").trim(),n=new URLSearchParams;n.set("rid",r),n.set("birthDate",t),l&&n.set("name",l);let i=await fetch("/api/stripe/checkout",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({rid:r,slug:e,returnTo:`/e/${e}?${n.toString()}`})}),o=await i.json();if(!i.ok)throw Error(o?.error||"CHECKOUT_FAILED");if(!o?.url)throw Error("MISSING_CHECKOUT_URL");window.location.href=o.url}catch(e){U(String(e?.message??e)),$(!1)}}}return(0,t.jsx)("main",{className:"min-h-screen px-4 py-10 text-neutral-100",style:{backgroundImage:"url('/brand/bg.png')",backgroundSize:"contain",backgroundPosition:"center bottom",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed"},children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-5xl rounded-3xl border border-neutral-800 bg-neutral-950/60 p-6 shadow-2xl backdrop-blur-sm sm:p-8",children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-semibold tracking-tight sm:text-4xl",children:i?.title??e}),(0,t.jsx)("p",{className:"mt-2 max-w-3xl text-sm leading-6 text-neutral-200/80",children:d?.heroSubtitle??""})]}),(0,t.jsx)("img",{src:"/brand/logo.png",alt:"Brand",className:"h-14 w-auto shrink-0 opacity-95"})]}),(0,t.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("a",{className:"rounded-lg border border-neutral-600 bg-neutral-900/60 px-3 py-2",href:"/",children:"Domov"}),(0,t.jsx)("a",{className:"rounded-lg border border-neutral-600 bg-neutral-900/60 px-3 py-2",href:"/list",children:"Späť na zoznam"})]}),(0,t.jsx)("span",{className:"rounded-full border border-neutral-700 px-3 py-1 text-xs text-neutral-300",children:o?"preview mode":`paid: ${String(y)}`})]}),(d?.intro?.title||d?.intro?.text)&&(0,t.jsxs)("section",{className:"mb-4 rounded-2xl border border-neutral-800 bg-neutral-900/70 p-4",children:[d?.intro?.title?(0,t.jsx)("h2",{className:"text-lg font-semibold",children:d.intro.title}):null,d?.intro?.text?(0,t.jsx)("p",{className:"mt-2 text-sm text-neutral-300",children:d.intro.text}):null]}),w?null:(0,t.jsxs)("section",{className:"mb-4 rounded-2xl border border-neutral-800 bg-neutral-900/70 p-4",children:[(0,t.jsx)("h2",{className:"mb-3 text-lg font-semibold",children:d?.form?.title||"Zadaj údaje"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsx)("input",{className:"min-w-[220px] flex-1 rounded-lg border border-neutral-700 bg-neutral-950/80 px-3 py-2 text-sm",placeholder:d?.form?.nameLabel||"Meno (voliteľné)",value:p,onChange:e=>h(e.target.value)}),(0,t.jsx)("input",{className:"min-w-[220px] flex-1 rounded-lg border border-neutral-700 bg-neutral-950/80 px-3 py-2 text-sm",placeholder:d?.form?.birthDateLabel||"dd.mm.rrrr alebo YYYY-MM-DD",value:b,onChange:e=>{let t,r;return g((r=(t=String(e.target.value||"").trim()).replace(/\D/g,"").slice(0,8),/^\d*$/.test(t)?r.length<=2?r:r.length<=4?`${r.slice(0,2)}.${r.slice(2)}`:`${r.slice(0,2)}.${r.slice(2,4)}.${r.slice(4)}`:t.slice(0,10)))}}),(0,t.jsx)("button",{className:"rounded-lg bg-neutral-100 px-4 py-2 font-semibold text-neutral-950",onClick:T,children:d?.form?.submitLabel||"Vyhodnotiť"})]}),C?(0,t.jsx)("p",{className:"mt-3 text-sm font-semibold text-red-300",children:C}):null]}),O?.categories?.length?(0,t.jsxs)("section",{className:"rounded-2xl border border-neutral-800 bg-neutral-900/70 p-4",children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:d?.result?.teaserTitle||"Výsledok"}),E?null:(0,t.jsx)("p",{className:"mt-1 text-sm text-neutral-300",children:d?.result?.teaserNote||"Zobrazený je len teaser. Zvyšok sa sprístupní po platbe."})]}),E?(0,t.jsx)("span",{className:"text-sm text-emerald-300",children:"Sprístupnené"}):(0,t.jsx)("button",{className:"rounded-lg border border-neutral-500 bg-neutral-950/70 px-4 py-2 text-sm",disabled:v||!a(b),onClick:L,children:v?"Presmerovávam...":d?.paywall?.cta||"Pokračovať na platbu"})]}),(0,t.jsx)("div",{className:"grid gap-3",children:O.categories.map((e,r)=>(0,t.jsxs)("article",{className:"rounded-xl border border-neutral-800 bg-neutral-950/70 p-4",children:[(0,t.jsxs)("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsx)("h3",{className:"text-base font-semibold",children:e.title??`Kateg\xf3ria ${r+1}`}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs text-neutral-300",children:["number"==typeof e.score?(0,t.jsxs)("span",{className:"rounded-full border border-neutral-700 px-2 py-1",children:["Skóre: ",e.score]}):null,n(e.band)?(0,t.jsx)("span",{className:"rounded-full border border-neutral-700 px-2 py-1",children:n(e.band)}):null,"number"==typeof e.percentile?(0,t.jsxs)("span",{className:"rounded-full border border-neutral-700 px-2 py-1",children:["Percentil: ",e.percentile]}):null]})]}),(e.insight??"").trim()?(0,t.jsx)("p",{className:"mb-2 text-sm text-neutral-300",children:e.insight}):null,(e.recommendation??"").trim()&&E?(0,t.jsx)("p",{className:"mb-3 text-sm text-neutral-300",children:e.recommendation}):null,(0,t.jsx)("div",{className:"grid gap-2",children:(e.items??[]).map((e,r)=>(0,t.jsxs)("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900/70 p-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold",children:e.title??`Položka ${r+1}`}),"number"==typeof e.value?(0,t.jsxs)("p",{className:"mt-1 text-xs text-neutral-400",children:["Hodnota: ",e.value]}):null,(e.text??"").trim()&&(e.text??"").trim()!==(e.title??"").trim()?(0,t.jsx)("p",{className:"mt-2 text-sm text-neutral-200",children:e.text}):null]},e.id??r))})]},e.key??r))}),!E&&d?.paywall?.headline?(0,t.jsxs)("div",{className:"mt-4 rounded-xl border border-neutral-700 bg-neutral-950/80 p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold",children:d.paywall.headline}),Array.isArray(d?.paywall?.bullets)&&d.paywall.bullets.length>0?(0,t.jsx)("ul",{className:"mt-2 list-disc space-y-1 pl-5 text-sm text-neutral-300",children:d.paywall.bullets.map((e,r)=>(0,t.jsx)("li",{children:e},`${e}-${r}`))}):null,d?.result?.unlockHint?(0,t.jsx)("p",{className:"mt-2 text-xs text-neutral-400",children:d.result.unlockHint}):null]}):null]}):(0,t.jsx)("section",{className:"rounded-2xl border border-neutral-800 bg-neutral-900/70 p-4 text-sm text-neutral-300",children:"Výsledok zatiaľ nie je vygenerovaný."})]})})}e.s(["default",()=>i])}]);