(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87391,e=>{"use strict";var t=e.i(43476),r=e.i(71645);function n(e){return String(e??"").trim()}function a(e,t){return`${e}-${String(t).padStart(3,"0")}`}function i(e,t){return`c${e+1}_t${t+1}`}function o(e,t){let r=n(e)||"Task",a=Array.isArray(t)?t.map(n).filter(Boolean):[];for(0===a.length&&(a=[r,r+" (quick)",r+" (deep)"]);a.length<3;)a.push(a[a.length-1]);return a.length>3&&(a=a.slice(0,3)),a}function s(e){let t,r=function(e){if(!Array.isArray(e?.groups)||e?.tasks)return e;let t=e.groups.filter(e=>"string"==typeof e&&e.trim()),r=Array.isArray(e?.tasks)?e.tasks:[];return e.categories=t.map((e,t)=>({id:`cat-${t+1}`,title:e,tasks:r})),e}({...e});if(!r.tasks&&Array.isArray(r.categories)&&(r.tasks={pickPerCategory:3,categories:r.categories.map((e,t)=>{let r=Array.isArray(e?.tasks)?e.tasks:[];return{key:String(e?.id||e?.key||`cat-${t+1}`),title:String(e?.title||`Kateg\xf3ria ${t+1}`),pool:r.map((e,r)=>{let n=e?.variants||{};return{id:String(e?.id||`t${t+1}-${r+1}`),title:String(e?.title||`\xdaloha ${r+1}`),metricKey:String(e?.metricKey||e?.id||`m_${t+1}_${r+1}`),variants:[{when:{lte:33},text:String(n?.lte||"")},{when:{between:[34,66]},text:String(n?.between||"")},{when:{gte:67},text:String(n?.gte||"")}]}})}})}),r.title&&"string"==typeof r.title&&r.title.trim()||(Array.isArray(r.groups)&&r.groups.length>0?r.title=String(r.groups[0]||"").trim()||"Generovaná edícia":Array.isArray(r.categories)&&r.categories.length>0?r.title=String(r.categories[0]?.title||"").trim()||"Generovaná edícia":r.title="Generovaná edícia"),r.slug&&"string"==typeof r.slug&&r.slug.trim()||(t=String(r.title||"generated-edition").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,64),r.slug=/^[a-z0-9][a-z0-9-]{1,62}[a-z0-9]$/.test(t)?t:"generated-edition"),(!r.content||"object"!=typeof r.content||Array.isArray(r.content))&&(r.content={heroTitle:String(r.title||r.slug||"Edícia"),heroSubtitle:"Personalizovaný prehľad",intro:{title:"Úvod",text:"Vyplň krátky formulár a získaj výsledok."},form:{title:"Vyhodnotenie",nameLabel:"Meno",birthDateLabel:"Dátum narodenia",submitLabel:"Vyhodnotiť"},result:{teaserTitle:"Náhľad",teaserNote:"Zobrazený je len teaser.",unlockHint:"Odomkni celý výsledok."},paywall:{headline:"Odomkni celý výsledok",bullets:["Všetky kategórie","Plný text","Personalizované výstupy"],cta:"Pokračovať na platbu"}}),r.engine&&"object"==typeof r.engine||(r.engine={subject:String(r.slug||"edition").replace(/-/g,"_"),locale:"sk"}),r.tasks&&Array.isArray(r.tasks.categories)){let e,t=e=>String(e??"").trim(),n=(e,r)=>{if(Array.isArray(e)&&e.every(e=>"object"==typeof e?.when&&"string"==typeof e?.text)){let t=e.slice(0,3);if(3===t.length)return t}let n=[];Array.isArray(e)?n=e.map(t):e&&"object"==typeof e&&(n=[t(e.lte),t(e.between),t(e.gte)]);let a=t(r)||"Task",[i,o,s]=(e=>{let t=e.filter(Boolean);if(0===t.length)return["","",""];for(;t.length<3;)t.push(t[t.length-1]);return t.slice(0,3)})(n.length?n:[a,a,a]);return[{when:{lte:33},text:i||a},{when:{between:[34,66]},text:o||i||a},{when:{gte:67},text:s||o||i||a}]};r.tasks={...r.tasks,pickPerCategory:Number.isFinite(e=Number(r.tasks.pickPerCategory))?Math.max(1,Math.min(5,Math.floor(e))):3,categories:r.tasks.categories.map((e,r)=>{let a=String(e?.key||e?.id||`cat-${r+1}`);return{key:a,title:String(e?.title||`Kateg\xf3ria ${r+1}`),pool:(Array.isArray(e?.pool)?e.pool:Array.isArray(e?.tasks)?e.tasks:[]).map((e,a)=>{if("string"==typeof e){let i=t(e);return{id:`t${r+1}-${a+1}`,title:i||`Task ${a+1}`,metricKey:`m_${r+1}_${a+1}`,variants:n([i],i||`Task ${a+1}`)}}let i=String(e?.title??e?.name??e?.text??`Task ${a+1}`),o=e&&"object"==typeof e&&"variants"in e?e.variants:e;return{id:String(e?.id||`t${r+1}-${a+1}`),title:String(i),metricKey:String(e?.metricKey||`m_${r+1}_${a+1}`),variants:n(o,i)}})}})}}return r}function l(e){var t,r;let n,a,i;return(a=(r=(n=(t=String(e??"").replace(/^\uFEFF/,"").replace(/[\u0300-\u036f]/g,"").trim()).match(/^```(?:json)?\s*\n([\s\S]*?)\n```$/i))?n[1].trim():t).indexOf("{"),i=r.lastIndexOf("}"),-1===a||-1===i||i<=a?r:r.slice(a,i+1)).trim()}function c(e,t=[]){let r,u=l(e);try{var d;d=r=JSON.parse(u),d?.tasks?.categories&&Array.isArray(d.tasks.categories)&&(d.tasks.categories=d.tasks.categories.map((e,t)=>{let r=n(e?.title??`Category ${t+1}`)||`Category ${t+1}`,s=(Array.isArray(e?.tasks)?e.tasks:[]).map((e,r)=>(function(e,t,r){if("string"==typeof r){let s=n(r);return{id:a(`c${e+1}t${t+1}`,1),title:s,metricKey:i(e,t),variants:o(s,null)}}let s=n(r?.title??r?.name??r?.text??"");return{id:n(r?.id)||a(`c${e+1}t${t+1}`,1),title:s||"Task",metricKey:n(r?.metricKey)||i(e,t),variants:o(s||"Task",r?.variants)}})(t,r,e));return{...e,title:r,tasks:s}}))}catch(t){return{ok:!1,error:"INVALID_JSON",details:String(t?.message??t),debug:{rawStart:String(e??"").slice(0,120),normalizedStart:u.slice(0,120),foundRootKeys:[]}}}let g=(r=s(r))&&"object"==typeof r&&!Array.isArray(r)?Object.keys(r):[];if(!r||"object"!=typeof r||Array.isArray(r))return{ok:!1,error:"NOT_OBJECT",debug:{foundRootKeys:g,normalizedStart:u.slice(0,120)}};if("string"!=typeof r.slug||!r.slug.trim())return{ok:!1,error:"MISSING_SLUG",debug:{foundRootKeys:g,normalizedStart:u.slice(0,120)}};if("string"!=typeof r.title||!r.title.trim())return{ok:!1,error:"MISSING_TITLE",debug:{foundRootKeys:g,normalizedStart:u.slice(0,120)}};if(!r.content||"object"!=typeof r.content||Array.isArray(r.content))return{ok:!1,error:"MISSING_CONTENT_OBJECT",debug:{foundRootKeys:g,normalizedStart:u.slice(0,120)}};let m=r.slug.trim();if(!/^[a-z0-9][a-z0-9-]{1,62}[a-z0-9]$/.test(m))return{ok:!1,error:"BAD_SLUG",details:m,debug:{foundRootKeys:g,normalizedStart:u.slice(0,120)}};if(t.includes(m))return{ok:!1,error:"DUPLICATE_SLUG",details:m,debug:{foundRootKeys:g,normalizedStart:u.slice(0,120)}};if(void 0!==r.tasks){let e=r.tasks;if(!e||"object"!=typeof e||Array.isArray(e))return{ok:!1,error:"TASKS_NOT_OBJECT",debug:{foundRootKeys:g}};let t=Number(e.pickPerCategory??3);if(!Number.isFinite(t)||t<1||t>5)return{ok:!1,error:"TASKS_PICK_OUT_OF_RANGE",details:e.pickPerCategory,debug:{foundRootKeys:g}};if(!Array.isArray(e.categories)||5!==e.categories.length)return{ok:!1,error:"TASKS_NOT_5_CATEGORIES",details:Array.isArray(e.categories)?e.categories.length:null,debug:{foundRootKeys:g}};for(let r=0;r<e.categories.length;r++){let n=e.categories[r],a=Array.isArray(n?.pool)?n.pool:Array.isArray(n?.tasks)?n.tasks:null;if(!Array.isArray(a))return{ok:!1,error:"CATEGORY_POOL_MISSING",details:`cat#${r+1}`,debug:{foundRootKeys:g}};let i=Math.max(5,Math.floor(t));if(a.length<i)return{ok:!1,error:"CATEGORY_POOL_TOO_SMALL",details:`cat#${r+1} len=${a.length} (min ${i})`,debug:{foundRootKeys:g}};for(let e=0;e<a.length;e++){let t=a[e];if("string"!=typeof t?.id||!t.id.trim())return{ok:!1,error:"TASK_ID_MISSING",details:`cat#${r+1} task#${e+1}`};if("string"!=typeof t?.title||!t.title.trim())return{ok:!1,error:"TASK_TITLE_MISSING",details:`cat#${r+1} task#${e+1}`};if("string"!=typeof t?.metricKey||!t.metricKey.trim())return{ok:!1,error:"TASK_METRICKEY_MISSING",details:`cat#${r+1} task#${e+1}`};let n=Array.isArray(t?.variants)?t.variants:null;if(!n||3!==n.length)return{ok:!1,error:"TASK_VARIANTS_NOT_3",details:`cat#${r+1} task#${e+1}`};let i=n.some(e=>"number"==typeof e?.when?.lte&&"string"==typeof e?.text),o=n.some(e=>Array.isArray(e?.when?.between)&&2===e.when.between.length&&"string"==typeof e?.text),s=n.some(e=>"number"==typeof e?.when?.gte&&"string"==typeof e?.text);if(!i||!o||!s)return{ok:!1,error:"TASK_VARIANTS_BAD_SHAPE",details:`cat#${r+1} task#${e+1}`}}}}return{ok:!0,obj:{...r,slug:m,title:r.title.trim()}}}function u(e){return['ROLE: Si generator edicii pre COSO Factory (Next.js app).\n\nVYSTUP:\n- Vrat presne 1 JSON objekt (ziadny markdown, ziadne komentare, ziadny dalsi text).\n- Musi to byt strict JSON (dvojite uvodzovky, ziadne trailing commas).\n\nCIEĽ:\n- Vymysli novu koherentnu ediciu (tema, nazov, texty, tasky).\n- Musi to byt prakticke, bezpecne, pouzitelne ako denny sebareflexny nastroj.\n\nKONTEXT PRODUKTU:\n- Edicia je stranka na /e/<slug>.\n- Pouzivatel moze zadat meno a birthDate (YYYY-MM-DD) ako volitelne vstupy.\n- Full vysledok je za paywallom; bez platby je len teaser.\n\nHARD REQUIREMENTS:\n1) slug: lowercase-hyphen, 3-64 znakov, musi byt unikatny a NESMIE byt v zozname uz nasadenych slugov nizsie.\n2) engine.locale = "sk"\n3) engine.subject: snake_case, 3-40 znakov, tematicky suvisiace s ediciou.\n4) content: vypln vsetky polia realnym textom (ziadne "...").\n5) tasks:\n- pickPerCategory musi byt 3\n- categories musi byt presne 5 poloziek\n- kazda kategoria musi mat pool presne 30 task objektov\n- kazdy task objekt musi mat: id, title, metricKey, variants\n- variants musi byt presne 3 prvky v tomto tvare:\n  (1) { when: { lte: 33 }, text: "..." }\n  (2) { when: { between: [34,66] }, text: "..." }\n  (3) { when: { gte: 67 }, text: "..." }\n\nAKO TO NAVRHNUT, ABY TO DAVALO ZMYSEL:\n- Zvol jednu jasnu temu (napr. fokus, hranice, komunikacia, regeneracia, rozhodovanie).\n- Navrhni 5 kategorii, ktore spolu tvoria model (napr. Fokus, Energia, Hranice, Komunikacia, Obnova).\n- Pre kazdu kategoriu vytvor 30 mikro-uloch (konkretne, vykonatelne, bezpecne).\n- Pre kazdu ulohu napis 3 varianty textu podla skore:\n  lte (nizke skore): jemny start, minimal effort.\n  between (stred): udrziavaci krok, male zlepsenie.\n  gte (vysoke): narocnejsi/preciznejsi krok bez tlaku.\n- metricKey rob konzistentne: m_catX_tYY (napr. m_cat3_t14).\n\nBEZPECNOST:\n- Bez medicinskych diagnoz, bez terapeutickych tvrdeni, bez nelegalnych navodov.\n\nJSON SCHEMA (MUSI SEDIT S KLUCAMI):\n{\n  "slug": "...",\n  "title": "...",\n  "engine": { "subject": "...", "locale": "sk" },\n  "content": {\n    "heroTitle": "...",\n    "heroSubtitle": "...",\n    "intro": { "title": "...", "text": "..." },\n    "form": {\n      "title": "...",\n      "nameLabel": "Meno (volitelne)",\n      "birthDateLabel": "Datum narodenia (volitelne)",\n      "submitLabel": "Vyhodnotit"\n    },\n    "result": {\n      "teaserTitle": "...",\n      "teaserNote": "...",\n      "unlockHint": "..."\n    },\n    "paywall": {\n      "headline": "...",\n      "bullets": ["...", "...", "..."],\n      "cta": "Pokracovat na platbu"\n    }\n  },\n  "tasks": {\n    "pickPerCategory": 3,\n    "categories": [\n      {\n        "key": "cat-1",\n        "title": "...",\n        "pool": [\n          {\n            "id": "t1-01",\n            "title": "...",\n            "metricKey": "m_cat1_t01",\n            "variants": [\n              { "when": { "lte": 33 }, "text": "..." },\n              { "when": { "between": [34, 66] }, "text": "..." },\n              { "when": { "gte": 67 }, "text": "..." }\n            ]\n          }\n        ]\n      },\n      { "key": "cat-2", "title": "...", "pool": [ /* 30 task objects */ ] },\n      { "key": "cat-3", "title": "...", "pool": [ /* 30 task objects */ ] },\n      { "key": "cat-4", "title": "...", "pool": [ /* 30 task objects */ ] },\n      { "key": "cat-5", "title": "...", "pool": [ /* 30 task objects */ ] }\n    ]\n  }\n}\n\nFINAL SELF-CHECK (sprav potichu pred vystupom):\n- slug je unikatny vs deployed list?\n- categories ma presne 5?\n- pickPerCategory je 3?\n- kazda kategoria ma pool presne 30?\n- kazdy task ma variants presne 3 s lte/between/gte?\n- ziaden placeholder "..." vo finalnom JSON?\n\nAlready deployed editions (MUST AVOID):',e.map(e=>`- ${e}`).join("\n")||"- (none)"].join("\n")}function d({editions:e}){let[n,a]=(0,r.useState)(e.map(e=>e.slug)),i=(0,r.useMemo)(()=>u(n),[n]),[o,d]=(0,r.useState)(i),[g,m]=(0,r.useState)(""),[y,k]=(0,r.useState)({kind:"idle",msg:""});async function p(){try{await navigator.clipboard.writeText(o),k({kind:"ok",msg:"Prompt copied."})}catch{k({kind:"err",msg:"Copy failed."})}}async function b(){k({kind:"idle",msg:"Starting factory workflow..."});try{let e=await fetch("/api/editions/slugs",{cache:"no-store"}),t=await e.json().catch(()=>null);if(!e.ok||!t?.ok||!Array.isArray(t?.slugs))return void k({kind:"err",msg:`Refresh failed: ${t?.error??e.status}`.trim()});let r=t.slugs.map(e=>String(e)).filter(Boolean);a(r),d(u(r)),k({kind:"ok",msg:`Refresh OK. Slugs loaded: ${r.length}`})}catch{k({kind:"err",msg:"Refresh failed."})}}async function f(){let e=c(g,n);if(!e.ok){let t=e?.debug??{},r=Array.isArray(t.foundRootKeys)?t.foundRootKeys:[],n=String(t.normalizedStart??"").replace(/\s+/g," ").trim();k({kind:"err",msg:`Neplatny JSON: ${e.error}${e.details?` (${e.details})`:""}; root keys: ${r.join(", ")||"(none)"}; normalized head: ${n}`});return}k({kind:"idle",msg:"Starting factory workflow..."});let t=await fetch("/api/factory/dispatch",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({edition:e.obj,rawEditionJson:g})}),r=await t.json().catch(()=>null);t.ok&&r?.ok?(k({kind:"ok",msg:"string"==typeof r?.message&&r.message.trim()?r.message.trim():`OK. Edition saved to repo. slug=${String(r?.slug??"").trim()}`}),m("")):k({kind:"err",msg:`Dispatch zlyhal: ${r?.error??t.status} ${r?.message??""}`.trim()})}return(0,t.jsx)("main",{className:"min-h-screen px-4 py-10 text-neutral-100",style:{backgroundImage:"url(/brand/bg.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-4xl translate-y-6 rounded-2xl border border-neutral-800 bg-neutral-900/70 p-6 shadow-xl backdrop-blur",children:[(0,t.jsx)("div",{className:"mb-6 flex justify-center",children:(0,t.jsx)("img",{src:"/brand/logo.png",alt:"Brand",style:{height:120,width:"auto"}})}),(0,t.jsx)("h1",{className:"text-3xl font-semibold tracking-tight",children:"Factory Builder"}),(0,t.jsx)("p",{className:"mt-2 text-sm leading-6 text-neutral-200/80",children:"Prompt and list of editions (slugs) are used as input context."}),(0,t.jsxs)("section",{className:"mt-8 space-y-2",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"1) Prompt pre LLM"}),(0,t.jsx)("textarea",{value:o,onChange:e=>d(e.target.value),rows:18,className:"w-full rounded-xl border border-neutral-700 bg-neutral-950/80 p-3 font-mono text-sm leading-6 outline-none focus:border-neutral-500"}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap gap-3",children:[(0,t.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:p,children:"Copy prompt"}),(0,t.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:b,children:"Refresh"}),(0,t.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:()=>d(i),children:"Reset prompt"}),(0,t.jsx)("a",{href:"/list",className:"rounded-lg border border-neutral-200/40 bg-neutral-950/30 px-3 py-2 text-sm text-neutral-100",children:"View deployed editions"})]})]}),(0,t.jsxs)("section",{className:"mt-8 space-y-2",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"2) Paste LLM JSON and build the edition"}),(0,t.jsx)("textarea",{value:g,onChange:e=>m(e.target.value),rows:12,placeholder:"You can paste plain JSON, a `json ... ` block, or text that contains a JSON object.",className:"w-full rounded-xl border border-neutral-700 bg-neutral-950/80 p-3 font-mono text-sm leading-6 outline-none focus:border-neutral-500"}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap gap-3",children:[(0,t.jsx)("button",{className:"rounded-lg bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-950",onClick:()=>{let e=c(g,n);k(e.ok?{kind:"ok",msg:"JSON looks valid."}:{kind:"err",msg:`Invalid JSON: ${e.error}`})},children:"Validate"}),(0,t.jsx)("button",{className:"rounded-lg bg-emerald-300 px-3 py-2 text-sm font-semibold text-emerald-950",onClick:f,children:"Dispatch build"}),(0,t.jsx)("button",{className:"rounded-lg border border-neutral-200/40 bg-neutral-950/30 px-3 py-2 text-sm text-neutral-100",onClick:()=>{let e=function(e){let t=l(e);try{let e=JSON.parse(t),r=s(e);return JSON.stringify(r,null,2)}catch{return function(e){let t=String(e??""),r=t.indexOf("{");if(r<0)return null;let n=!1,a=!1,i=0;for(let e=r;e<t.length;e++){let o=t[e];if(n){if(a){a=!1;continue}if("\\"===o){a=!0;continue}'"'===o&&(n=!1);continue}if('"'===o){n=!0;continue}if("{"===o&&i++,"}"===o&&0==--i){let n=t.slice(r,e+1).trim();try{return JSON.parse(n),n}catch{}}}return null}(t)??t}}(g);m(e),k({kind:"ok",msg:`JSON normalized (${e.length} chars). Missing title/slug/content were auto-filled.`})},children:"Normalize JSON"})]}),y.msg&&(0,t.jsxs)("p",{className:`mt-3 rounded-xl border p-3 text-sm ${"err"===y.kind?"border-red-500 text-red-200":"ok"===y.kind?"border-green-500 text-green-200":"border-neutral-200/40 text-neutral-100"} bg-neutral-950/40`,children:[(0,t.jsxs)("strong",{children:["err"===y.kind?"Error":"ok"===y.kind?"OK":"Info",":"]})," ",y.msg]})]})]})})}e.s(["default",()=>d],87391)}]);